{"remainingRequest":"D:\\æ¡Œé¢\\Smart-Kitchen-Manager\\src\\main\\resources\\front\\front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\æ¡Œé¢\\Smart-Kitchen-Manager\\src\\main\\resources\\front\\front\\src\\pages\\statistics\\foodusage.vue?vue&type=style&index=0&id=0b60011b&scoped=true&lang=css","dependencies":[{"path":"D:\\æ¡Œé¢\\Smart-Kitchen-Manager\\src\\main\\resources\\front\\front\\src\\pages\\statistics\\foodusage.vue","mtime":1766837548723},{"path":"D:\\æ¡Œé¢\\Smart-Kitchen-Manager\\src\\main\\resources\\front\\front\\node_modules\\css-loader\\dist\\cjs.js","mtime":1766827791737},{"path":"D:\\æ¡Œé¢\\Smart-Kitchen-Manager\\src\\main\\resources\\front\\front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1766827794726},{"path":"D:\\æ¡Œé¢\\Smart-Kitchen-Manager\\src\\main\\resources\\front\\front\\node_modules\\postcss-loader\\src\\index.js","mtime":1766827793567},{"path":"D:\\æ¡Œé¢\\Smart-Kitchen-Manager\\src\\main\\resources\\front\\front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1766827789760},{"path":"D:\\æ¡Œé¢\\Smart-Kitchen-Manager\\src\\main\\resources\\front\\front\\node_modules\\vue-loader\\lib\\index.js","mtime":1766827794095}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouZWwtdGFibGUgPj4+IC50b3AtMS1yb3cgew0KICBiYWNrZ3JvdW5kOiAjZmVmMGYwOw0KfQ0KLmVsLXRhYmxlID4+PiAudG9wLTItcm93IHsNCiAgYmFja2dyb3VuZDogI2ZkZjZlYzsNCn0NCi5lbC10YWJsZSA+Pj4gLnRvcC0zLXJvdyB7DQogIGJhY2tncm91bmQ6ICNmMGY5ZmY7DQp9DQo="},{"version":3,"sources":["foodusage.vue"],"names":[],"mappings":";AAqRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"foodusage.vue","sourceRoot":"src/pages/statistics","sourcesContent":["<template>\r\n  <div>\r\n    <div :style='{\"padding\":\"12px\",\"margin\":\"10px auto\",\"borderColor\":\"#dbd9f4\",\"borderRadius\":\"8px\",\"background\":\"#fff\",\"borderWidth\":\"0 0 2px\",\"width\":\"1200px\",\"borderStyle\":\"solid\"}' class=\"breadcrumb-preview\">\r\n      <el-breadcrumb :separator=\"'Î'\" :style='{\"width\":\"100%\",\"margin\":\"0 auto\",\"fontSize\":\"14px\",\"lineHeight\":\"1\",\"display\":\"flex\"}'>\r\n        <el-breadcrumb-item>é¦–é¡µ</el-breadcrumb-item>\r\n        <el-breadcrumb-item>ç»Ÿè®¡åˆ†æ</el-breadcrumb-item>\r\n        <el-breadcrumb-item>å¸¸ç”¨é£Ÿæåˆ†æ</el-breadcrumb-item>\r\n      </el-breadcrumb>\r\n    </div>\r\n    \r\n    <div class=\"statistics-preview\" :style='{\"width\":\"1200px\",\"margin\":\"10px auto\",\"position\":\"relative\",\"background\":\"none\"}'>\r\n      \r\n      <!-- ç»Ÿè®¡å¡ç‰‡ -->\r\n      <el-row :gutter=\"20\" :style='{\"marginBottom\":\"20px\"}'>\r\n        <el-col :span=\"6\">\r\n          <el-card shadow=\"hover\" :style='{\"background\":\"linear-gradient(135deg, #667eea 0%, #764ba2 100%)\",\"color\":\"#fff\"}'>\r\n            <div :style='{\"fontSize\":\"14px\",\"marginBottom\":\"10px\"}'>é£Ÿæç§ç±»</div>\r\n            <div :style='{\"fontSize\":\"32px\",\"fontWeight\":\"bold\"}'>{{stats.totalTypes}}</div>\r\n            <div :style='{\"fontSize\":\"12px\",\"marginTop\":\"5px\",\"opacity\":\"0.8\"}'>ç§</div>\r\n          </el-card>\r\n        </el-col>\r\n        <el-col :span=\"6\">\r\n          <el-card shadow=\"hover\" :style='{\"background\":\"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)\",\"color\":\"#fff\"}'>\r\n            <div :style='{\"fontSize\":\"14px\",\"marginBottom\":\"10px\"}'>æ€»ä½¿ç”¨æ¬¡æ•°</div>\r\n            <div :style='{\"fontSize\":\"32px\",\"fontWeight\":\"bold\"}'>{{stats.totalUsage}}</div>\r\n            <div :style='{\"fontSize\":\"12px\",\"marginTop\":\"5px\",\"opacity\":\"0.8\"}'>æ¬¡</div>\r\n          </el-card>\r\n        </el-col>\r\n        <el-col :span=\"6\">\r\n          <el-card shadow=\"hover\" :style='{\"background\":\"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)\",\"color\":\"#fff\"}'>\r\n            <div :style='{\"fontSize\":\"14px\",\"marginBottom\":\"10px\"}'>æœ€å¸¸ç”¨é£Ÿæ</div>\r\n            <div :style='{\"fontSize\":\"24px\",\"fontWeight\":\"bold\"}'>{{stats.mostUsed}}</div>\r\n            <div :style='{\"fontSize\":\"12px\",\"marginTop\":\"5px\",\"opacity\":\"0.8\"}'>{{stats.mostUsedCount}}æ¬¡</div>\r\n          </el-card>\r\n        </el-col>\r\n        <el-col :span=\"6\">\r\n          <el-card shadow=\"hover\" :style='{\"background\":\"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)\",\"color\":\"#fff\"}'>\r\n            <div :style='{\"fontSize\":\"14px\",\"marginBottom\":\"10px\"}'>å¹³å‡ä½¿ç”¨é¢‘ç‡</div>\r\n            <div :style='{\"fontSize\":\"32px\",\"fontWeight\":\"bold\"}'>{{stats.avgFrequency}}</div>\r\n            <div :style='{\"fontSize\":\"12px\",\"marginTop\":\"5px\",\"opacity\":\"0.8\"}'>æ¬¡/å‘¨</div>\r\n          </el-card>\r\n        </el-col>\r\n      </el-row>\r\n      \r\n      <!-- é£Ÿæä½¿ç”¨æ’è¡Œ -->\r\n      <el-card :style='{\"marginBottom\":\"20px\"}'>\r\n        <div slot=\"header\">\r\n          <span :style='{\"fontSize\":\"18px\",\"fontWeight\":\"bold\"}'>ğŸ“Š é£Ÿæä½¿ç”¨æ’è¡Œæ¦œ TOP 10</span>\r\n        </div>\r\n        \r\n        <el-table :data=\"topFoods\" :style='{\"width\":\"100%\"}' :row-class-name=\"tableRowClassName\">\r\n          <el-table-column type=\"index\" label=\"æ’å\" width=\"80\" align=\"center\">\r\n            <template slot-scope=\"scope\">\r\n              <el-tag v-if=\"scope.$index === 0\" type=\"danger\" size=\"small\">ğŸ¥‡</el-tag>\r\n              <el-tag v-else-if=\"scope.$index === 1\" type=\"warning\" size=\"small\">ğŸ¥ˆ</el-tag>\r\n              <el-tag v-else-if=\"scope.$index === 2\" type=\"success\" size=\"small\">ğŸ¥‰</el-tag>\r\n              <span v-else>{{scope.$index + 1}}</span>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column prop=\"shicaiName\" label=\"é£Ÿæåç§°\" width=\"200\"></el-table-column>\r\n          <el-table-column prop=\"usageCount\" label=\"ä½¿ç”¨æ¬¡æ•°\" width=\"120\" align=\"center\">\r\n            <template slot-scope=\"scope\">\r\n              <el-tag type=\"primary\">{{scope.row.usageCount}} æ¬¡</el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column prop=\"totalQuantity\" label=\"æ€»ä½¿ç”¨é‡\" width=\"150\" align=\"center\">\r\n            <template slot-scope=\"scope\">\r\n              {{scope.row.totalQuantity}} {{scope.row.unit}}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column prop=\"lastUsedDate\" label=\"æœ€åä½¿ç”¨\" width=\"180\"></el-table-column>\r\n          <el-table-column label=\"ä½¿ç”¨é¢‘ç‡\" align=\"center\">\r\n            <template slot-scope=\"scope\">\r\n              <el-progress :percentage=\"scope.row.percentage\" :color=\"getProgressColor(scope.row.percentage)\"></el-progress>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n      </el-card>\r\n      \r\n      <!-- é£Ÿæåˆ†ç±»ç»Ÿè®¡ -->\r\n      <el-row :gutter=\"20\">\r\n        <el-col :span=\"12\">\r\n          <el-card>\r\n            <div slot=\"header\">\r\n              <span :style='{\"fontSize\":\"18px\",\"fontWeight\":\"bold\"}'>ğŸ¥— é£Ÿæä½¿ç”¨é¢‘ç‡åˆ†å¸ƒ</span>\r\n            </div>\r\n            <div :style='{\"padding\":\"20px\"}'>\r\n              <div v-for=\"item in frequencyDistribution\" :key=\"item.level\" :style='{\"marginBottom\":\"15px\"}'>\r\n                <div :style='{\"display\":\"flex\",\"justifyContent\":\"space-between\",\"marginBottom\":\"5px\"}'>\r\n                  <span>{{item.label}}</span>\r\n                  <span>{{item.count}} ç§ ({{item.percentage}}%)</span>\r\n                </div>\r\n                <el-progress :percentage=\"item.percentage\" :color=\"item.color\" :show-text=\"false\"></el-progress>\r\n              </div>\r\n            </div>\r\n          </el-card>\r\n        </el-col>\r\n        \r\n        <el-col :span=\"12\">\r\n          <el-card>\r\n            <div slot=\"header\">\r\n              <span :style='{\"fontSize\":\"18px\",\"fontWeight\":\"bold\"}'>ğŸ’¡ ä½¿ç”¨å»ºè®®</span>\r\n            </div>\r\n            <div :style='{\"padding\":\"20px\",\"lineHeight\":\"2\"}'>\r\n              <el-alert v-for=\"(tip, index) in suggestions\" :key=\"index\" :title=\"tip.title\" :type=\"tip.type\" :closable=\"false\" :style='{\"marginBottom\":\"10px\"}'>\r\n                <div>{{tip.content}}</div>\r\n              </el-alert>\r\n            </div>\r\n          </el-card>\r\n        </el-col>\r\n      </el-row>\r\n      \r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      stats: {\r\n        totalTypes: 0,\r\n        totalUsage: 0,\r\n        mostUsed: '-',\r\n        mostUsedCount: 0,\r\n        avgFrequency: 0\r\n      },\r\n      topFoods: [],\r\n      frequencyDistribution: [],\r\n      suggestions: []\r\n    }\r\n  },\r\n  created() {\r\n    this.loadStatistics();\r\n  },\r\n  methods: {\r\n    loadStatistics() {\r\n      let userid = this.$storage.get('userid');\r\n      \r\n      // è·å–ç”¨æˆ·çš„é£Ÿæä½¿ç”¨æ•°æ®\r\n      this.$http.get('usershicai/list', {\r\n        params: {\r\n          page: 1,\r\n          limit: 1000,\r\n          userid: userid\r\n        }\r\n      }).then(res => {\r\n        if (res.data && res.data.code === 0) {\r\n          this.processStatistics(res.data.data.list);\r\n        }\r\n      });\r\n    },\r\n    \r\n    processStatistics(data) {\r\n      if (!data || data.length === 0) {\r\n        return;\r\n      }\r\n      \r\n      // ç»Ÿè®¡æ¯ç§é£Ÿæçš„ä½¿ç”¨æƒ…å†µ\r\n      let foodMap = {};\r\n      data.forEach(item => {\r\n        let name = item.shicaiName;\r\n        if (!foodMap[name]) {\r\n          foodMap[name] = {\r\n            shicaiName: name,\r\n            usageCount: 0,\r\n            totalQuantity: 0,\r\n            unit: item.unit || 'ä¸ª',\r\n            lastUsedDate: item.purchaseDate\r\n          };\r\n        }\r\n        foodMap[name].usageCount++;\r\n        foodMap[name].totalQuantity += parseFloat(item.quantity || 0);\r\n        if (item.purchaseDate > foodMap[name].lastUsedDate) {\r\n          foodMap[name].lastUsedDate = item.purchaseDate;\r\n        }\r\n      });\r\n      \r\n      // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº\r\n      let foodList = Object.values(foodMap);\r\n      foodList.sort((a, b) => b.usageCount - a.usageCount);\r\n      \r\n      // è®¡ç®—ç»Ÿè®¡æ•°æ®\r\n      this.stats.totalTypes = foodList.length;\r\n      this.stats.totalUsage = data.length;\r\n      if (foodList.length > 0) {\r\n        this.stats.mostUsed = foodList[0].shicaiName;\r\n        this.stats.mostUsedCount = foodList[0].usageCount;\r\n      }\r\n      this.stats.avgFrequency = (data.length / 4).toFixed(1); // å‡è®¾ç»Ÿè®¡4å‘¨æ•°æ®\r\n      \r\n      // TOP 10\r\n      let maxCount = foodList[0].usageCount;\r\n      this.topFoods = foodList.slice(0, 10).map(item => ({\r\n        ...item,\r\n        percentage: Math.round((item.usageCount / maxCount) * 100)\r\n      }));\r\n      \r\n      // é¢‘ç‡åˆ†å¸ƒ\r\n      let highFreq = foodList.filter(f => f.usageCount >= 10).length;\r\n      let normalFreq = foodList.filter(f => f.usageCount >= 5 && f.usageCount < 10).length;\r\n      let lowFreq = foodList.filter(f => f.usageCount < 5).length;\r\n      let total = foodList.length;\r\n      \r\n      this.frequencyDistribution = [\r\n        {\r\n          level: 'high',\r\n          label: 'é«˜é¢‘é£Ÿæ (â‰¥10æ¬¡)',\r\n          count: highFreq,\r\n          percentage: Math.round((highFreq / total) * 100),\r\n          color: '#67C23A'\r\n        },\r\n        {\r\n          level: 'normal',\r\n          label: 'ä¸­é¢‘é£Ÿæ (5-9æ¬¡)',\r\n          count: normalFreq,\r\n          percentage: Math.round((normalFreq / total) * 100),\r\n          color: '#E6A23C'\r\n        },\r\n        {\r\n          level: 'low',\r\n          label: 'ä½é¢‘é£Ÿæ (<5æ¬¡)',\r\n          count: lowFreq,\r\n          percentage: Math.round((lowFreq / total) * 100),\r\n          color: '#909399'\r\n        }\r\n      ];\r\n      \r\n      // ç”Ÿæˆå»ºè®®\r\n      this.generateSuggestions(foodList);\r\n    },\r\n    \r\n    generateSuggestions(foodList) {\r\n      this.suggestions = [];\r\n      \r\n      if (foodList.length > 0) {\r\n        let top3 = foodList.slice(0, 3).map(f => f.shicaiName).join('ã€');\r\n        this.suggestions.push({\r\n          title: 'å¸¸ç”¨é£Ÿæ',\r\n          content: `æ‚¨æœ€å¸¸ä½¿ç”¨çš„é£Ÿææ˜¯ï¼š${top3}ï¼Œå»ºè®®ä¿æŒé€‚é‡åº“å­˜ã€‚`,\r\n          type: 'success'\r\n        });\r\n      }\r\n      \r\n      let lowFreqFoods = foodList.filter(f => f.usageCount < 3);\r\n      if (lowFreqFoods.length > 5) {\r\n        this.suggestions.push({\r\n          title: 'é£Ÿæå¤šæ ·æ€§',\r\n          content: `æ‚¨æœ‰ ${lowFreqFoods.length} ç§ä½é¢‘ä½¿ç”¨çš„é£Ÿæï¼Œå»ºè®®å¢åŠ è¿™äº›é£Ÿæçš„ä½¿ç”¨é¢‘ç‡ï¼Œä¿æŒé¥®é£Ÿå¤šæ ·æ€§ã€‚`,\r\n          type: 'warning'\r\n        });\r\n      }\r\n      \r\n      this.suggestions.push({\r\n        title: 'å¥åº·æç¤º',\r\n        content: 'å»ºè®®æ¯å‘¨æ‘„å…¥è‡³å°‘20ç§ä¸åŒçš„é£Ÿæï¼Œä¿æŒè¥å…»å‡è¡¡ã€‚',\r\n        type: 'info'\r\n      });\r\n    },\r\n    \r\n    tableRowClassName({row, rowIndex}) {\r\n      if (rowIndex === 0) return 'top-1-row';\r\n      if (rowIndex === 1) return 'top-2-row';\r\n      if (rowIndex === 2) return 'top-3-row';\r\n      return '';\r\n    },\r\n    \r\n    getProgressColor(percentage) {\r\n      if (percentage >= 80) return '#67C23A';\r\n      if (percentage >= 50) return '#E6A23C';\r\n      return '#909399';\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.el-table >>> .top-1-row {\r\n  background: #fef0f0;\r\n}\r\n.el-table >>> .top-2-row {\r\n  background: #fdf6ec;\r\n}\r\n.el-table >>> .top-3-row {\r\n  background: #f0f9ff;\r\n}\r\n</style>\r\n"]}]}
# 需求文档

## 简介

本文档规定了智能厨房管理系统中食谱智能推荐功能的需求。该功能基于用户当前的食材库存提供智能食谱推荐，计算食材匹配度并过滤包含过敏原的食谱。

## 术语表

- **食谱推荐系统（Recipe_Recommendation_System）**: 将用户食材与食谱需求进行匹配的智能推荐引擎
- **用户食材库（User_Ingredient_Inventory）**: 用户当前拥有的食材集合（存储在user_shicai表中）
- **匹配度（Match_Rate）**: 计算公式为（已拥有食材数 / 食谱所需总食材数）的百分比
- **过敏原过滤器（Allergy_Filter）**: 排除包含用户过敏食材的食谱的组件
- **食材状态（Ingredient_Status）**: 食材的状态（new新鲜、used已用、expired过期、discarded丢弃）

## 需求

### 需求 1: 用户食材库检索

**用户故事:** 作为用户，我希望系统能识别我的可用食材，以便基于我实际拥有的食材进行食谱推荐。

#### 验收标准

1. WHEN 检索用户食材时，THE 食谱推荐系统 SHALL 仅查询状态为'new'或'used'的食材
2. WHEN 检索用户食材时，THE 食谱推荐系统 SHALL 排除状态为'expired'或'discarded'的食材
3. WHEN 用户没有有效食材时，THE 食谱推荐系统 SHALL 返回空推荐列表并附带适当提示信息
4. THE 食谱推荐系统 SHALL 检索食材数量信息以供未来功能增强使用

### 需求 2: 食谱食材匹配

**用户故事:** 作为用户，我希望看到与我可用食材匹配的食谱，以便用现有食材进行烹饪。

#### 验收标准

1. WHEN 计算匹配度时，THE 食谱推荐系统 SHALL 按公式（已拥有食材数 / 食谱所需总食材数）进行计算
2. WHEN 食谱需要食材时，THE 食谱推荐系统 SHALL 识别用户拥有哪些所需食材
3. WHEN 食谱需要食材时，THE 食谱推荐系统 SHALL 识别用户缺少哪些所需食材
4. THE 食谱推荐系统 SHALL 将匹配度计算为0到100之间的百分比值
5. WHEN 多个食谱具有相同匹配度时，THE 食谱推荐系统 SHALL 保持一致的排序

### 需求 3: 基于匹配度的优先级排序

**用户故事:** 作为用户，我希望食材匹配度高的食谱优先显示，以便快速找到我现在就能做的食谱。

#### 验收标准

1. WHEN 对推荐结果排序时，THE 食谱推荐系统 SHALL 按匹配度降序排列食谱
2. WHEN 食谱匹配度 ≥ 60%时，THE 食谱推荐系统 SHALL 将其标记为高优先级
3. WHEN 食谱匹配度 < 60%时，THE 食谱推荐系统 SHALL 包含缺少食材的数量
4. THE 食谱推荐系统 SHALL 在提供sortType参数时支持按热度排序的替代方案

### 需求 4: 过敏原过滤

**用户故事:** 作为有食物过敏的用户，我希望排除包含我的过敏原的食谱，以便安全地烹饪推荐的食谱。

#### 验收标准

1. WHEN 用户定义了过敏信息时，THE 过敏原过滤器 SHALL 从yonghu表中检索该信息
2. WHEN 食谱包含与用户过敏原列表匹配的任何食材时，THE 过敏原过滤器 SHALL 从推荐中排除该食谱
3. WHEN 用户没有过敏信息时，THE 过敏原过滤器 SHALL 不排除任何食谱
4. THE 过敏原过滤器 SHALL 对过敏原名称执行不区分大小写的匹配

### 需求 5: 推荐API端点

**用户故事:** 作为前端开发者，我希望有一个RESTful API端点用于食谱推荐，以便将其集成到用户界面中。

#### 验收标准

1. THE 食谱推荐系统 SHALL 在 /caipuxinxi/recommend 路径暴露GET端点
2. WHEN userId参数缺失时，THE 食谱推荐系统 SHALL 返回HTTP 400及错误消息
3. WHEN 提供userId参数时，THE 食谱推荐系统 SHALL 返回分页的推荐结果
4. THE 食谱推荐系统 SHALL 支持pageNum参数，默认值为1
5. THE 食谱推荐系统 SHALL 支持pageSize参数，默认值为10
6. THE 食谱推荐系统 SHALL 支持可选的sortType参数用于排序策略

### 需求 6: 响应数据结构

**用户故事:** 作为前端开发者，我希望响应中包含全面的食谱信息，以便向用户显示所有必要的详细信息。

#### 验收标准

1. WHEN 返回推荐结果时，THE 食谱推荐系统 SHALL 为每个结果包含食谱ID
2. WHEN 返回推荐结果时，THE 食谱推荐系统 SHALL 为每个结果包含食谱名称
3. WHEN 返回推荐结果时，THE 食谱推荐系统 SHALL 为每个结果包含计算的匹配度
4. WHEN 返回推荐结果时，THE 食谱推荐系统 SHALL 为每个结果包含完整的所需食材列表
5. WHEN 返回推荐结果时，THE 食谱推荐系统 SHALL 为每个结果包含缺失食材列表
6. WHEN 返回推荐结果时，THE 食谱推荐系统 SHALL 为每个结果包含烹饪步骤
7. THE 食谱推荐系统 SHALL 格式化响应以兼容现有系统响应格式

### 需求 7: 数据库查询性能

**用户故事:** 作为系统管理员，我希望数据库查询高效，以便推荐系统在负载下表现良好。

#### 验收标准

1. THE 食谱推荐系统 SHALL 在获取食谱食材时避免N+1查询问题
2. WHEN 获取食谱数据时，THE 食谱推荐系统 SHALL 使用JOIN操作最小化数据库往返次数
3. THE 食谱推荐系统 SHALL 在单次查询或最少查询中检索所有必要数据
4. WHEN 计算匹配度时，THE 食谱推荐系统 SHALL 在数据检索后在应用层执行计算

### 需求 8: 分页支持

**用户故事:** 作为用户，我希望能分页浏览推荐结果，以便在不使界面过载的情况下查看结果。

#### 验收标准

1. WHEN 提供pageNum和pageSize时，THE 食谱推荐系统 SHALL 仅返回请求的结果页
2. WHEN 计算分页时，THE 食谱推荐系统 SHALL 包含匹配食谱的总数
3. THE 食谱推荐系统 SHALL 返回分页元数据，包括当前页、页大小和总记录数
4. WHEN 请求的页超出可用结果时，THE 食谱推荐系统 SHALL 返回空结果及有效的分页元数据
